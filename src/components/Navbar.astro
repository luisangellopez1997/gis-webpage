---
import { Image } from "astro:assets";
import HorizontalSpace from "./HorizontalSpace.astro";
import LogoBig from "../assets/logo-big.png";
import { Icon } from "astro-icon/components";

const links = [
  { name: "Inicio", href: "/" },
  { name: "Empresa", href: "/empresa" },
  { name: "Servicios", href: "/servicios" },
  { name: "Sucursales", href: "/sucursales" },
  { name: "Contactos", href: "/contacto" },
];

const pathname = Astro.url.pathname;
---

<div
  class="navbar-open-button fixed top-4 right-4 text-white z-20 rounded-xl bg-primary p-2 md:hidden"
>
  <Icon name="mdi:menu" width={35} height={35} />
</div>
<div
  class="navbar hidden md:block fixed pt-2 md:pt-10 md:left-0 right-0 md:right-auto w-full z-20"
>
  <div
    class="navbar-bg absolute top-0 left-0 w-screen h-screen bg-[rgba(0,0,0,0.4)] md:hidden z-30"
  >
  </div>
  <HorizontalSpace>
    <div class="max-md:flex max-md:justify-end max-md:items-start">
      <div
        class="animate-scaleX z-40 bg-white rounded-lg flex flex-col md:flex-row justify-between items-center shadow-[0px_10px_10px_1px_rgba(0,0,0,0.1)] origin-right md:animate-none max-md:-mr-4 max-md:-mt-2 max-md:rounded-tr-none max-md:rounded-br-none max-md:h-screen max-md:justify-start max-md:max-w-[80%]"
      >
        <div
          class="mb-8 md:mb-0 flex justify-start items-start w-full md:w-auto"
        >
          <Image
            src={LogoBig}
            alt="logo"
            class="max-md:w-[80%] md:max-w-none md:w-auto md:h-[110px]"
          />
          <Icon
            name="mdi:close-circle"
            width={35}
            height={35}
            class="navbar-quit md:hidden right-2 mt-4 text-secondary"
          />
        </div>
        <div
          class="flex justify-end flex-col md:flex-row items-center w-full text-primary font-bold text-sm"
        >
          {
            links.map(({ name, href }) => {
              const thisPage = new RegExp(href + "$", "g").test(pathname);
              return (
                <div class="py-4 mb-4 last:mb-0 md:mb-0 md:py-14 px-6 relative flex-1 text-center w-full md:w-auto">
                  <a href={href} class="">
                    {name}
                  </a>
                  <div
                    class={`w-full bg-primary h-1 absolute bottom-0 left-0 right-0 ${thisPage ? "" : "hidden"}`}
                  />
                </div>
              );
            })
          }
        </div>
      </div>
    </div>
  </HorizontalSpace>
</div>

<script>
  const navbar = document.querySelector(".navbar")!;
  const navbarQuit = document.querySelector(".navbar-quit")!;
  const navbarBg = document.querySelector(".navbar-bg")!;
  const navbarOpenButton = document.querySelector(".navbar-open-button")!;

  navbarOpenButton.addEventListener("click", () => {
    navbar.classList.add("navbar-open");
  });

  navbarQuit.addEventListener("click", () => {
    navbar.classList.remove("navbar-open");
  });

  navbarBg.addEventListener("click", () => {
    navbar.classList.remove("navbar-open");
  });
</script>

<style>
  .navbar.navbar-open {
    display: block;
  }
</style>
